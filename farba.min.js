/*
	Copyright 2013 Sergey Chernykh
	Licensed under the Apache License, Version 2.0 (the "License");
	you may not use this file except in compliance with the License.
	You may obtain a copy of the License at
	   http://www.apache.org/licenses/LICENSE-2.0
	Unless required by applicable law or agreed to in writing, software
	distributed under the License is distributed on an "AS IS" BASIS,
	WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
	See the License for the specific language governing permissions and
	limitations under the License.
*/
var farbaUtils={addListener:function(e,f,g){if(e.addEventListener){e.addEventListener(f,g,false)}else{if(e.attachEvent){var h=function(){return g.apply(e,arguments)};e.attachEvent("on"+f,h)}else{e["on"+f]=g}}},removeListener:function(d,e,f){if(d.addEventListener){d.removeEventListener(e,f,false)}else{if(d.detachEvent){d.detachEvent("on"+e,f)}else{d["on"+e]=null}}},fixEvent:function(m){if(!m||!m.stopPropagation){var h=m||window.event;m={};for(var j in h){m[j]=h[j]}if(!m.target){m.target=m.srcElement||document}m.relatedTarget=m.fromElement===m.target?m.toElement:m.fromElement;m.preventDefault=function(){m.returnValue=false;m.isDefaultPrevented=l};m.isDefaultPrevented=n;m.stopPropagation=function(){m.cancelBubble=true;m.isPropagationStopped=l};m.isPropagationStopped=n;m.stopImmediatePropagation=function(){this.isImmediatePropagationStopped=l;this.stopPropagation()};m.isImmediatePropagationStopped=n;if(m.clientX!==null){var k=document.documentElement,i=document.body;m.pageX=m.clientX+(k&&k.scrollLeft||i&&i.scrollLeft||0)-(k&&k.clientLeft||i&&i.clientLeft||0);m.pageY=m.clientY+(k&&k.scrollTop||i&&i.scrollTop||0)-(k&&k.clientTop||i&&i.clientTop||0)}m.which=m.charCode||m.keyCode;if(m.button!==null){m.button=(m.button&1?0:(m.button&4?1:(m.button&2?2:0)))}}return m;function l(){return true}function n(){return false}},setLeftTop:function(e){var f=e.getBoundingClientRect(),d={};d.left=f.left+document.body.scrollLeft;d.top=f.top+document.body.scrollTop;return d},hexFromRGB:function(g,h,b){var i=[g.toString(16),h.toString(16),b.toString(16)],j=0;for(;j<3;j++){if(i[j].length===1){i[j]="0"+i[j]}}return i.join("").toUpperCase()},rgbFromHex:function(e){var g=parseInt(e.substring(0,2),16),h=parseInt(e.substring(2,4),16),f=parseInt(e.substring(4,6),16);return[g,h,f]},getPercent:function(b){return Math.round(b/2.55)},hslFromRGB:function(y,l,g){var w=y/255,v=l/255,b=g/255,d=Math.max(w,v,b),u=Math.min(w,v,b),r=[],h,s,z,x=(d+u)/2;if(d===u){s=z=0}else{h=d-u;z=(x>0.5)?h/(2-d-u):h/(d+u);switch(d){case w:s=(v-b)/h;break;case v:s=(b-w)/h+2;break;case b:s=(w-v)/h+4;break}}r[0]=Math.round((s>0)?s*60:(s*60+360));r[1]=Math.round(z*100);r[2]=Math.round(x*100);return r},colorLim:function(b){return(b>255)?255:((b<0)?0:b)},isNotEmpty:function(c){for(var d in c){if(c.hasOwnProperty(d)){return true}}return false},isArray:function(b){return(Object.prototype.toString.call(b)==="[object Array]")},isFunction:function(b){return(Object.prototype.toString.call(b)==="[object Function]")},isObject:function(b){return(Object.prototype.toString.call(b)==="[object Object]")},isNumber:function(b){return(Object.prototype.toString.call(b)==="[object Number]")},isString:function(b){return(Object.prototype.toString.call(b)==="[object String]")},isInt:function(b){return SeptembruaryUtils.isNumber(b)&&b%1===0},copyObject:function(d){var e,f={};for(e in d){if(d.hasOwnProperty(e)){f[e]=d[e]}}return f}};function Farba(u,am){var az,ap,ay,S,aB,R=false,aa=farbaUtils,Y=5,Z=255,X=255,ak=255,ac=function(){return aa.hexFromRGB(Z,X,ak)},ae=function(){return aa.hslFromRGB(Z,X,ak)[0]},T=function(){return aa.hslFromRGB(Z,X,ak)[1]},aC=function(){return aa.hslFromRGB(Z,X,ak)[2]},av=function(){return aa.getPercent(Z)},ai=function(){return aa.getPercent(X)},aD=function(){return aa.getPercent(ak)},al={hidden:false,getSizeByElement:false,width:250,height:238.8,mouseInvert:false,colorChangeDelay:30,paddingLeft:0,paddingRight:0,paddingTop:0,fontFamily:"sans-serif",circleStrokeWidth:2,rgbRelFontSize:0.2,colorBg:true,rgbText:true,rgbTextPosition:0.1,hexText:true,hslText:false,hexHslRelFontSize:0.15,hexHslTextShiftX:0,hexHslTextShiftY:0};this.init=function(){var a=u||"farba";aB=document.querySelector("#"+a);if(aB){au(aB);az=aA(al);ap=az.getContext("2d");ay=new W(az.width);S=new af(ay);aF(ap,ay,S);aq()}};this.getRed=function(){return Z};this.getGreen=function(){return X};this.getBlue=function(){return ak};this.getHue=function(){return ae()};this.getSaturation=function(){return T()};this.getLightness=function(){return aC()};this.getRGB=function(){return"rgb("+Z+","+X+","+ak+")"};this.getPercentRGB=function(){return"rgb("+av()+"%,"+ai()+"%,"+aD()+"%)"};this.getHex=function(a){return(a)?"#"+ac():ac()};this.getHSL=function(){return"hsl("+ae()+","+T()+"%,"+aC()+"%)"};this.reset=function(a){if(!a){ax("w",[1,1,1])}else{ax("b",[1,1,1])}aF(ap,ay,S)};this.exterminate=function(){aB.parentNode.removeChild(aB)};this.hide=function(b,a){aB.style.display="none";if(b){ax("w",[1,1,1]);aF(ap,ay,S)}if(a&&isFunction(a)){a()}};this.show=function(a){aB.style.display="inherit";if(a&&isFunction(a)){a()}};function at(b,a){var c=(a)?al.rgbRelFontSize:al.hexHslRelFontSize,d=c*b;return d+"px "+al.fontFamily}function au(c){var b,d=c.getAttribute("data-farba-options");if(d){try{b=JSON.parse(unescape(d))}catch(a){b=false}}if(b&&aa.isObject(b)&&aa.isNotEmpty(b)){aG(b)}if(am&&aa.isObject(am)&&aa.isNotEmpty(am)){aG(am)}if(al.getSizeByElement&&aB.clientHeight){al.width=aB.clientWidth;al.height=aB.clientHeight}if(al.hidden){c.style.display="none"}}function aG(b){for(var a in b){if(al.hasOwnProperty(a)){if(typeof al[a]===typeof b[a]){al[a]=b[a]}}}}function aA(b){var a=document.createElement("canvas");a.height=b.height;a.width=b.width;aB.appendChild(a);return a}function aE(f,d,a,b,e,c){f.beginPath();f.arc(d,a,b,0*Math.PI,2*Math.PI);f.fillStyle=e;f.fill();if(c&&al.circleStrokeWidth){f.strokeStyle=c;f.stroke()}}function W(g){var f=g*al.paddingTop/100,a=g*al.paddingLeft/100,e=g*al.paddingRight/100,c=(g-a-e)/3,b=aa.setLeftTop(az),d=c*Math.sqrt(3)/2;this.red={x:c+a,y:c+d+f,color:"rgb(255,0,0)"};this.blue={x:2*c+a,y:c+d+f,color:"rgb(0,0,255)"};this.green={x:c+c/2+a,y:c+f,color:"rgb(0,255,0)"};this.left=b.left;this.top=b.top;this.radius=c;this.stokeWidth=Math.round(c*al.circleStrokeWidth/100);this.center={x:c+c/2+a,y:c+2*d/3+f},this.radiuses={r1:d/2,r2:2*d/3,r3:d/3+d,r4:2*d/3+c}}function af(a){var b=a.radius,f=al.rgbTextPosition*b,e=a.red,d=a.green,c=a.blue;this.rStart={x:e.x-f,y:e.y+f};this.gStart={x:d.x,y:d.y-2*f};this.bStart={x:c.x+f,y:c.y+f};this.rgbFont=at(b,true);this.hexFont=at(b);this.underlay=ag(this.hexFont,a.center,b)}function aF(b,c,a){b.globalCompositeOperation="lighter";b.lineWidth=c.stokeWidth;var d=c.radius;b.clearRect(0,0,az.width,az.height);aE(b,c.red.x,c.red.y,d,c.red.color,"#FFFFFF");aE(b,c.blue.x,c.blue.y,d,c.blue.color,"#FFFFFF");aE(b,c.green.x,c.green.y,d,c.green.color,"#FFFFFF");ao(b,c,a);b.globalCompositeOperation="destination-over";if(al.colorBg){U(b)}b.globalCompositeOperation="source-over"}function ag(f,e,b){ap.font=f;var a={},c=al,g=(!c.hslText)?(ap.measureText("#888888").width):(ap.measureText("Saturation: 100%").width),d=parseInt(f,10);a.centX=e.x+(c.hexHslTextShiftX*b);a.centY=e.y+(c.hexHslTextShiftY*b);if(!c.hexText&&!c.hslText){return false}else{if(c.hexText&&c.hslText){a.h=d*5.6;a.hexY=a.centY-d*1.8;a.huY=a.centY-d*0.6;a.saY=a.centY+d*0.6;a.ltY=a.centY+d*1.8}else{if(c.hexText&&!c.hslText){a.h=d*1.4;a.hexY=a.centY}else{a.h=d*4.2;a.huY=a.centY-d*1.2;a.saY=a.centY;a.ltY=a.centY+d*1.2}}}a.l=1.2*g;a.y=a.centY-a.h/2;a.x=a.centX-a.l/2;return a}function ao(a,i,b){var h,d,f,e,g,c=255-Z,j=255-X,k=255-ak;if(!ao.rgbFont){ao.rgbFont=a.font}if(al.rgbText){a.font=b.rgbFont;a.textBaseline="top";a.textAlign="start";a.fillStyle=(ak<125)?"rgb(0,0,"+k+")":"#FFF";a.fillText("Blue: "+ak,b.bStart.x,b.bStart.y);a.textAlign="end";a.fillStyle=(Z<125)?"rgb("+c+",0,0)":"#FFF";a.fillText("Red: "+Z,b.rStart.x,b.rStart.y);a.textAlign="center";a.textBaseline="bottom";a.fillStyle=(X<125)?"rgb(0,"+j+",0)":"#FFF";a.fillText("Green: "+X,b.gStart.x,b.gStart.y)}if(al.hexText||al.hslText){d=b.underlay;a.globalCompositeOperation="source-over";a.font=b.hexFont;a.textAlign="center";a.textBaseline="middle";a.fillStyle="#FFF";a.fillRect(d.x,d.y,d.l,d.h);a.fillStyle="#000";if(al.hexText){h=ac();a.fillText("#"+h,d.centX,d.hexY)}if(al.hslText){if(!ao.degreeSign){ao.degreeSign=String.fromCharCode(parseInt("00B0",16))}f=ae();e=T();g=aC();a.fillText("Hue: "+f+ao.degreeSign,d.centX,d.huY);a.fillText("Saturation: "+e+"%",d.centX,d.saY);a.fillText("Lightness: "+g+"%",d.centX,d.ltY)}}}function U(a){a.fillStyle="rgb("+Z+","+X+","+ak+")";a.fillRect(0,0,al.width,al.height)}function aq(){ar();aa.addListener(window,"resize",ab);aa.addListener(az,"mousedown",aw);aa.addListener(az,"mouseup",ah);aa.addListener(az,"contextmenu",ad)}function V(){aa.removeListener(window,"resize",ab);aa.removeListener(az,"mousedown",aw);aa.removeListener(az,"mouseup",ah);aa.removeListener(az,"contextmenu",ad)}function ab(a){V();aq()}function ar(){var a=aa.setLeftTop(az);ay.left=a.left;ay.top=a.top}function ad(a){var b=aa.fixEvent(a);b.preventDefault()}function aw(h){var f=aa.fixEvent(h),b=f.pageX,d=f.pageY,g=b-ay.left,c=d-ay.top,a=f.shiftKey||f.ctrlKey||f.altKey,i=aj(g,c),e=(f.button)?1:-1;if(!a){if(al.mouseInvert){e*=-1}R=true;an(i,e,false);aF(ap,ay,S);setTimeout(function(){if(R){an(i,e,al.colorChangeDelay)}},300)}else{if(f.shiftKey){ax("w",i)}if(f.ctrlKey){ax("g",i)}if(f.altKey){ax("b",i)}aF(ap,ay,S)}}function ax(b,a){var c;if(b==="w"||b==="b"){c=(b==="w")?255:0;if(a[0]){Z=c}if(a[1]){X=c}if(a[2]){ak=c}}else{c=Math.round((Z+X+ak)/3);Z=c;X=c;ak=c}ay.red.color="rgb("+Z+",0,0)";ay.green.color="rgb(0,"+X+",0)";ay.blue.color="rgb(0,0,"+ak+")"}function aj(f,a){var b=ay,d=b.radius,c=[false,false,false],e=function(i,j){var k=i-f,g=j-a,h=Math.sqrt(Math.pow(k,2)+Math.pow(g,2));return h<d};if(e(b.red.x,b.red.y)){c[0]=true}if(e(b.green.x,b.green.y)){c[1]=true}if(e(b.blue.x,b.blue.y)){c[2]=true}return c}function ah(a){R=false}function an(e,f,a){var b,d,c;if(e[0]){b=Z+f;Z=aa.colorLim(b);ay.red.color="rgb("+Z+",0,0)"}if(e[1]){d=X+f;X=aa.colorLim(d);ay.green.color="rgb(0,"+X+",0)"}if(e[2]){c=ak+f;ak=aa.colorLim(c);ay.blue.color="rgb(0,0,"+ak+")"}if(R&&a){setTimeout(function(){aF(ap,ay,S);an(e,f,a)},a)}if(!R&&a){aF(ap,ay,S)}}};