/*
	Copyright 2013 Sergey Chernykh

	Licensed under the Apache License, Version 2.0 (the "License");
	you may not use this file except in compliance with the License.
	You may obtain a copy of the License at

		http://www.apache.org/licenses/LICENSE-2.0

	Unless required by applicable law or agreed to in writing, software
	distributed under the License is distributed on an "AS IS" BASIS,
	WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
	See the License for the specific language governing permissions and
	limitations under the License.
*/
var farbaUtils={addListener:function(b,a,d){if(b.addEventListener){b.addEventListener(a,d,false)}else{if(b.attachEvent){var c=function(){return d.apply(b,arguments)};b.attachEvent("on"+a,c)}else{b["on"+a]=d}}},removeListener:function(b,a,c){if(b.addEventListener){b.removeEventListener(a,c,false)}else{if(b.detachEvent){b.detachEvent("on"+a,c)}else{b["on"+a]=null}}},fixEvent:function(d){if(!d||!d.stopPropagation){var b=d||window.event;d={};for(var g in b){d[g]=b[g]}if(!d.target){d.target=d.srcElement||document}d.relatedTarget=d.fromElement===d.target?d.toElement:d.fromElement;d.preventDefault=function(){d.returnValue=false;d.isDefaultPrevented=e};d.isDefaultPrevented=c;d.stopPropagation=function(){d.cancelBubble=true;d.isPropagationStopped=e};d.isPropagationStopped=c;d.stopImmediatePropagation=function(){this.isImmediatePropagationStopped=e;this.stopPropagation()};d.isImmediatePropagationStopped=c;if(d.clientX!==null){var f=document.documentElement,a=document.body;d.pageX=d.clientX+(f&&f.scrollLeft||a&&a.scrollLeft||0)-(f&&f.clientLeft||a&&a.clientLeft||0);d.pageY=d.clientY+(f&&f.scrollTop||a&&a.scrollTop||0)-(f&&f.clientTop||a&&a.clientTop||0)}d.which=d.charCode||d.keyCode;if(d.button!==null){d.button=(d.button&1?0:(d.button&4?1:(d.button&2?2:0)))}}return d;function e(){return true}function c(){return false}},setLeftTop:function(a){var c=a.getBoundingClientRect(),b={};b.left=c.left+document.body.scrollLeft;b.top=c.top+document.body.scrollTop;return b},hexFromRGB:function(f,e,a){var d=[f.toString(16),e.toString(16),a.toString(16)],c=0;for(;c<3;c++){if(d[c].length===1){d[c]="0"+d[c]}}return d.join("").toUpperCase()},rgbFromHex:function(b){var d=parseInt(b.substring(0,2),16),c=parseInt(b.substring(2,4),16),a=parseInt(b.substring(4,6),16);return[d,c,a]},getPercent:function(a){return Math.round(a/2.55)},hslFromRGB:function(a,m,o){var e=a/255,f=m/255,q=o/255,p=Math.max(e,f,q),i=Math.min(e,f,q),k=[],n,j,t,c=(p+i)/2;if(p===i){j=t=0}else{n=p-i;t=(c>0.5)?n/(2-p-i):n/(p+i);switch(p){case e:j=(f-q)/n;break;case f:j=(q-e)/n+2;break;case q:j=(e-f)/n+4;break}}k[0]=Math.round((j>0)?j*60:(j*60+360));k[1]=Math.round(t*100);k[2]=Math.round(c*100);return k},colorLim:function(a){return(a>255)?255:((a<0)?0:a)},isNotEmpty:function(b){for(var a in b){if(b.hasOwnProperty(a)){return true}}return false},isArray:function(a){return(Object.prototype.toString.call(a)==="[object Array]")},isFunction:function(a){return(Object.prototype.toString.call(a)==="[object Function]")},isObject:function(a){return(Object.prototype.toString.call(a)==="[object Object]")},isNumber:function(a){return(Object.prototype.toString.call(a)==="[object Number]")},isString:function(a){return(Object.prototype.toString.call(a)==="[object String]")},isInt:function(a){return farbaUtils.isNumber(a)&&a%1===0},copyObject:function(b){var a,c={};for(a in b){if(b.hasOwnProperty(a)){c[a]=b[a]}}return c}};function Farba(P,v){var h,r,i,N,f,O=false,G=farbaUtils,H=255,I=255,x=255,E=function(){return G.hexFromRGB(H,I,x)},C=function(){return G.hslFromRGB(H,I,x)[0]},M=function(){return G.hslFromRGB(H,I,x)[1]},e=function(){return G.hslFromRGB(H,I,x)[2]},l=function(){return G.getPercent(H)},z=function(){return G.getPercent(I)},d=function(){return G.getPercent(x)},w={hidden:false,insertBefore:false,getSizeByElement:false,width:250,height:238.8,mouseInvert:false,colorChangeDelay:30,paddingLeft:0,paddingRight:0,paddingTop:0,fontFamily:"sans-serif",circleStrokeWidth:2,circleStrokeColor:"#FFF",rgbRelFontSize:0.2,colorBg:true,rgbText:true,rgbTextPosition:0.1,hexText:true,hslText:false,redTitle:"Red: ",greenTitle:"Green: ",blueTitle:"Blue: ",hueTitle:"Hue: ",saturationTitle:"Saturation: ",lightnessTitle:"Lightness: ",hexHslRelFontSize:0.15,hexHslTextShiftX:0,hexHslTextShiftY:0};if(!(this instanceof Farba)){return new Farba()}(function(){var u=P||"farba";f=document.querySelector("#"+u);if(f){m(f);h=g(w);r=h.getContext("2d");i=new J(h.width);N=new o(i,w);b(r,i,N);q()}})();this.getRed=function(){return H};this.getGreen=function(){return I};this.getBlue=function(){return x};this.getHue=function(){return C()};this.getSaturation=function(){return M()};this.getLightness=function(){return e()};this.getRGB=function(){return"rgb("+H+","+I+","+x+")"};this.getPercentRGB=function(){return"rgb("+l()+"%,"+z()+"%,"+d()+"%)"};this.getHex=function(u){return(u)?"#"+E():E()};this.getHSL=function(){return"hsl("+C()+","+M()+"%,"+e()+"%)"};this.reset=function(u){if(!u){j("w",[1,1,1])}else{j("b",[1,1,1])}b(r,i,N)};this.exterminate=function(u){if(u){f.removeChild(h)}else{f.parentNode.removeChild(f)}};this.hide=function(Q,u){f.style.display="none";if(Q){j("w",[1,1,1]);b(r,i,N)}if(u&&G.isFunction(u)){u()}};this.show=function(u){f.style.display="inherit";if(u&&G.isFunction(u)){u()}};this.options=function(u){if(u&&G.isObject(u)&&G.isNotEmpty(u)){a(u)}if(w.getSizeByElement&&f.clientHeight){w.width=f.clientWidth;w.height=f.clientHeight}if(w.hidden){f.style.display="none"}h.parentNode.removeChild(h);h=g(w);r=h.getContext("2d");i=new J(h.width);N=new o(i,w);i.red.color="rgb("+H+",0,0)";i.green.color="rgb(0,"+I+",0)";i.blue.color="rgb(0,0,"+x+")";b(r,i,N);q()};function n(S,u){var R=(u)?w.rgbRelFontSize:w.hexHslRelFontSize,Q=R*S;return Q+"px "+w.fontFamily}function m(R){var u,Q=R.getAttribute("data-farba-options");if(Q){try{u=JSON.parse(unescape(Q))}catch(S){u=false}}if(u&&G.isObject(u)&&G.isNotEmpty(u)){a(u)}if(v&&G.isObject(v)&&G.isNotEmpty(v)){a(v)}if(w.getSizeByElement&&R.clientHeight){w.width=R.clientWidth;w.height=R.clientHeight}if(w.hidden){R.style.display="none"}}function a(Q){for(var u in Q){if(w.hasOwnProperty(u)){if(typeof w[u]===typeof Q[u]){w[u]=Q[u]}}}}function g(R){var u=document.createElement("canvas"),Q=f.style.position==="relative";u.height=R.height;u.width=R.width;u.style.position=(Q)?"absolute":"relative";u.style.left="0px";u.style.top="0px";if(R.insertBefore){f.insertBefore(u,f.firstChild)}else{f.appendChild(u)}return u}function c(Q,u,U,T,R,S){Q.beginPath();Q.arc(u,U,T,0*Math.PI,2*Math.PI);Q.fillStyle=R;Q.fill();if(S&&w.circleStrokeWidth){Q.strokeStyle=S;Q.stroke()}}function J(Q){var R=Q*w.paddingTop/100,V=Q*w.paddingLeft/100,S=Q*w.paddingRight/100,T=(Q-V-S)/3,U=G.setLeftTop(h),u=T*Math.sqrt(3)/2;this.red={x:T+V,y:T+u+R,color:"rgb(255,0,0)"};this.blue={x:2*T+V,y:T+u+R,color:"rgb(0,0,255)"};this.green={x:T+T/2+V,y:T+R,color:"rgb(0,255,0)"};this.left=U.left;this.top=U.top;this.radius=T;this.strokeWidth=Math.round(T*w.circleStrokeWidth/100);this.strokeColor=w.circleStrokeColor;this.center={x:T+T/2+V,y:T+2*u/3+R}}function o(V,T){var U=V.radius,Q=w.rgbTextPosition*U,R=V.red,S=V.green,u=V.blue;this.rStart={x:R.x-Q,y:R.y+Q};this.gStart={x:S.x,y:S.y-2*Q};this.bStart={x:u.x+Q,y:u.y+Q};this.redTitle=T.redTitle;this.greenTitle=T.greenTitle;this.blueTitle=T.blueTitle;this.hueTitle=T.hueTitle;this.satTitle=T.saturationTitle;this.ltTitle=T.lightnessTitle;this.rgbFont=n(U,true);this.hexFont=n(U);this.underlay=B(this.hexFont,V.center,U)}function b(T,S,Q){T.globalCompositeOperation="lighter";T.lineWidth=S.strokeWidth;var R=S.radius,u=S.strokeColor;T.clearRect(0,0,h.width,h.height);c(T,S.red.x,S.red.y,R,S.red.color,u);c(T,S.blue.x,S.blue.y,R,S.blue.color,u);c(T,S.green.x,S.green.y,R,S.green.color,u);s(T,S,Q);T.globalCompositeOperation="destination-over";if(w.colorBg){L(T)}T.globalCompositeOperation="source-over"}function B(R,u,U){r.font=R;var V={},T=w,Q=(!T.hslText)?(r.measureText("#888888").width):(r.measureText("Saturation: 100%").width),S=parseInt(R,10);V.centX=u.x+(T.hexHslTextShiftX*U);V.centY=u.y+(T.hexHslTextShiftY*U);if(!T.hexText&&!T.hslText){return false}else{if(T.hexText&&T.hslText){V.h=S*5.6;V.hexY=V.centY-S*1.8;V.huY=V.centY-S*0.6;V.saY=V.centY+S*0.6;V.ltY=V.centY+S*1.8}else{if(T.hexText&&!T.hslText){V.h=S*1.4;V.hexY=V.centY}else{V.h=S*4.2;V.huY=V.centY-S*1.2;V.saY=V.centY;V.ltY=V.centY+S*1.2}}}V.l=1.2*Q;V.y=V.centY-V.h/2;V.x=V.centX-V.l/2;return V}function s(Z,R,Y){var S,W,U,V,T,X=255-H,Q=255-I,u=255-x;if(!s.rgbFont){s.rgbFont=Z.font}if(w.rgbText){Z.font=Y.rgbFont;Z.textBaseline="top";Z.textAlign="start";Z.fillStyle=(x<125)?"rgb(0,0,"+u+")":"#FFF";Z.fillText(Y.blueTitle+x,Y.bStart.x,Y.bStart.y);Z.textAlign="end";Z.fillStyle=(H<125)?"rgb("+X+",0,0)":"#FFF";Z.fillText(Y.redTitle+H,Y.rStart.x,Y.rStart.y);Z.textAlign="center";Z.textBaseline="bottom";Z.fillStyle=(I<125)?"rgb(0,"+Q+",0)":"#FFF";Z.fillText(Y.greenTitle+I,Y.gStart.x,Y.gStart.y)}if(w.hexText||w.hslText){W=Y.underlay;Z.globalCompositeOperation="source-over";Z.font=Y.hexFont;Z.textAlign="center";Z.textBaseline="middle";Z.fillStyle="#FFF";Z.fillRect(W.x,W.y,W.l,W.h);Z.fillStyle="#000";if(w.hexText){S=E();Z.fillText("#"+S,W.centX,W.hexY)}if(w.hslText){if(!s.degreeSign){s.degreeSign=String.fromCharCode(parseInt("00B0",16))}U=C();V=M();T=e();Z.fillText(Y.hueTitle+U+s.degreeSign,W.centX,W.huY);Z.fillText(Y.satTitle+V+"%",W.centX,W.saY);Z.fillText(Y.ltTitle+T+"%",W.centX,W.ltY)}}}function L(u){u.fillStyle="rgb("+H+","+I+","+x+")";u.fillRect(0,0,w.width,w.height)}function q(){p();G.addListener(window,"resize",F);G.addListener(h,"mousedown",k);G.addListener(h,"mouseup",A);G.addListener(h,"contextmenu",D)}function K(){G.removeListener(window,"resize",F);G.removeListener(h,"mousedown",k);G.removeListener(h,"mouseup",A);G.removeListener(h,"contextmenu",D)}function F(u){K();q()}function p(){var u=G.setLeftTop(h);i.left=u.left;i.top=u.top}function D(u){var Q=G.fixEvent(u);Q.preventDefault()}function k(Q){var S=G.fixEvent(Q),W=S.pageX,U=S.pageY,R=W-i.left,V=U-i.top,X=S.shiftKey||S.ctrlKey||S.altKey,u=y(R,V),T=(S.button)?1:-1;if(!X){if(w.mouseInvert){T*=-1}O=true;t(u,T,false);b(r,i,N);setTimeout(function(){if(O){t(u,T,w.colorChangeDelay)}},300)}else{if(S.ctrlKey){j("w",u)}if(S.shiftKey){j("g",u)}if(S.altKey){j("b",u)}b(r,i,N)}}function j(R,u){var Q;if(R==="w"||R==="b"){Q=(R==="w")?255:0;if(u[0]){H=Q}if(u[1]){I=Q}if(u[2]){x=Q}}else{Q=Math.round((H+I+x)/3);H=Q;I=Q;x=Q}i.red.color="rgb("+H+",0,0)";i.green.color="rgb(0,"+I+",0)";i.blue.color="rgb(0,0,"+x+")"}function y(Q,U){var T=i,S=T.radius,u=[false,false,false],R=function(Y,X){var W=Y-Q,V=X-U,Z=Math.sqrt(Math.pow(W,2)+Math.pow(V,2));return Z<S};if(R(T.red.x,T.red.y)){u[0]=true}if(R(T.green.x,T.green.y)){u[1]=true}if(R(T.blue.x,T.blue.y)){u[2]=true}return u}function A(){O=false}function t(R,Q,U){var T,S,u;if(R[0]){T=H+Q;H=G.colorLim(T);i.red.color="rgb("+H+",0,0)"}if(R[1]){S=I+Q;I=G.colorLim(S);i.green.color="rgb(0,"+I+",0)"}if(R[2]){u=x+Q;x=G.colorLim(u);i.blue.color="rgb(0,0,"+x+")"}if(O&&U){setTimeout(function(){b(r,i,N);t(R,Q,U)},U)}if(!O&&U){b(r,i,N)}}};